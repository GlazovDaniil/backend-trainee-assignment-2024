# Тестовое задание для стажёра Backend
## Запуск проекта
- Перейдите в терминале в **backend-trainee-assignment-2024\Banners>** в папку проекта
- Запустите Docker на вашем PC и пропишите в терминале **docker-compose up --build** (если первый раз появится ошибка - повторите, почему-то бывает не с первого раза билдит)
  
### Вход в контейнер проекта, чобы выполнять команды
- Откройте второе оконо терминала и перейдите в ту же деррикторию backend-trainee-assignment-2024\Banners> и пропишите комманду **docker ps -aqf "name=banners"**
- В терминале выдастся id вашего контейнера (первая строка)
- В терминале пропишите команду **docker exec -it <id_container> bash**, где **<id_container>** id контейнера полученный на предыдущем шаге
  
### Если запуск первый
### или необходимо применить внесенные изменения в БД, то все шаги, кроме последнего
- Перейдя в контейнер последовательно напишите два команды для миграции изменений в БД:
  1) **python manage.py makemigrations**
  2) **python manage.py migrate**
- Создайте супераользователя командой, следуя инструкциям: python manage.py createsuperuser
- Для доальнейшего тестирования системы зайдите в админ панель под созданным суперпользователем и заполните таблицы данными http://localhost:8000/admin/

### Если необходимо запустить интеграционный тест (из за докера и его любви с джанго не получается законектится к копии БД для тестов)
Можно, конечно, вкрючить тесты всего этого великолепия, но тут придется попотеть((((
- В файле в каталоге **backend-trainee-assignment-2024\Banners\Banners>** зайдя в **settings.py** поменять на 87 строке значение 'postgres' на 'localhost'
  
  ![image](https://github.com/GlazovDaniil/backend-trainee-assignment-2024/assets/78955311/3be60220-1b66-4193-9aee-5f3609c6d48b)

- Надо сделать БД на своем ПК с данными указанными в **settings.py**, чтобы подключаться к ней
- Сделать миграцию в БД
  1) **python manage.py makemigrations**
  2) **python manage.py migrate**
- Перейти в терминале в каталог проекта **backend-trainee-assignment-2024\Banners>**
- Запустить тест командой **python manage.py test**

## Проблемы, с которыми столкнулся
### В стандартных методах **Django rest** обработчиков **GET** и **PUT** запросов нередусмотрена проверка прав доступа
- Пришлось явно проверять наличие прав доступа у пользователей в момент обработки запроса, от чего любой пользователь модет отправить PUT запрос, но только **у администраторов и суперпользователя он пройдет**, а у простых пользователей - нет.

## Примеры запросов
- Получение пользователем с неверным токеном банера
   ![image](https://github.com/GlazovDaniil/backend-trainee-assignment-2024/assets/78955311/a07933ba-dfe2-432b-bd84-9a992a617548)

- Получение пользовательского баннера
  ![image](https://github.com/GlazovDaniil/backend-trainee-assignment-2024/assets/78955311/bf9e7471-f786-4220-b174-856c39e4da53)

- Попытка обычного пользователя, без прав администратора, получить список всех баннеров
  ![image](https://github.com/GlazovDaniil/backend-trainee-assignment-2024/assets/78955311/00b281da-30cc-4720-a942-c05cd4962478)

- Получение списка баннеров с помошью админского токена
  ![image](https://github.com/GlazovDaniil/backend-trainee-assignment-2024/assets/78955311/81cae153-48ad-47a6-a036-4d89771b1aa9)

- Создание баннера под админсскоим токеном для существующего набора фича - теги
  ![image](https://github.com/GlazovDaniil/backend-trainee-assignment-2024/assets/78955311/79fe98e9-54df-45a3-a15b-1cef33f9f58d)

- Создание баннера под админсскоим токеном
  ![image](https://github.com/GlazovDaniil/backend-trainee-assignment-2024/assets/78955311/e9e6d62d-789c-4185-9655-df0ff25329a2)

- Попытка создания баннера под токеном обычного пользователя
  ![image](https://github.com/GlazovDaniil/backend-trainee-assignment-2024/assets/78955311/2ef1a933-56f9-485f-b34b-f3d8a3fda381)

- Изменение баннера токеном админа 
  ![image](https://github.com/GlazovDaniil/backend-trainee-assignment-2024/assets/78955311/ee693d7d-456e-4560-8154-930948fd2200)

- Попытка изменения баннера под токеном обычного пользователя
  ![image](https://github.com/GlazovDaniil/backend-trainee-assignment-2024/assets/78955311/2545191c-280d-40f1-98c2-da9cafb40889)

- Удаление таблицы токеном администратора
  ![image](https://github.com/GlazovDaniil/backend-trainee-assignment-2024/assets/78955311/c613bbd4-1159-44a1-873d-a53a9b9b7d03)

- Попытка удаления баннера под токеном обычного пользователя
  ![image](https://github.com/GlazovDaniil/backend-trainee-assignment-2024/assets/78955311/b32dab48-c644-46de-8fed-45bc5d6b9e18)


## P.S.
### Передаю приветик крысюкам, которые сами ничего не могут, лишь чужой код тыбзить, это даже не спортивно)))
Закоммитил 5 числа единственный раз и увидел это...


![image](https://github.com/GlazovDaniil/backend-trainee-assignment-2024/assets/78955311/a7432cfc-330c-421b-9ab5-4d4b58606750)



# Задание

## Сервис баннеров
В Авито есть большое количество неоднородного контента, для которого необходимо иметь единую систему управления.  В частности, необходимо показывать разный контент пользователям в зависимости от их принадлежности к какой-либо группе. Данный контент мы будем предоставлять с помощью баннеров.
## Описание задачи
Необходимо реализовать сервис, который позволяет показывать пользователям баннеры, в зависимости от требуемой фичи и тега пользователя, а также управлять баннерами и связанными с ними тегами и фичами.
## Общие вводные
**Баннер** — это документ, описывающий какой-либо элемент пользовательского интерфейса. Технически баннер представляет собой  JSON-документ неопределенной структуры. 
**Тег** — это сущность для обозначения группы пользователей; представляет собой число (ID тега). 
**Фича** — это домен или функциональность; представляет собой число (ID фичи).  
1. Один баннер может быть связан только с одной фичей и несколькими тегами
2. При этом один тег, как и одна фича, могут принадлежать разным баннерам одновременно
3. Фича и тег однозначно определяют баннер

Так как баннеры являются для пользователя вспомогательным функционалом, допускается, если пользователь в течение короткого срока будет получать устаревшую информацию.  При этом существует часть пользователей (порядка 10%), которым обязательно получать самую актуальную информацию. Для таких пользователей нужно предусмотреть механизм получения информации напрямую из БД.
## Условия
1. Используйте этот [API](https://drive.google.com/file/d/1l4PMTPzsjksRCd_lIm0mVfh4U0Jn-A2R/view?usp=share_link)
2. Тегов и фичей небольшое количество (до 1000), RPS — 1k, SLI времени ответа — 50 мс, SLI успешности ответа — 99.99%
3. Для авторизации доступов должны использоваться 2 вида токенов: пользовательский и админский.  Получение баннера может происходить с помощью пользовательского или админского токена, а все остальные действия могут выполняться только с помощью админского токена.  
4. Реализуйте интеграционный или E2E-тест на сценарий получения баннера.
5. Если при получении баннера передан флаг use_last_revision, необходимо отдавать самую актуальную информацию.  В ином случае допускается передача информации, которая была актуальна 5 минут назад.
6. Баннеры могут быть временно выключены. Если баннер выключен, то обычные пользователи не должны его получать, при этом админы должны иметь к нему доступ.

## Дополнительные задания:
Эти задания не являются обязательными, но выполнение всех или части из них даст вам преимущество перед другими кандидатами. 
1. Адаптировать систему для значительного увеличения количества тегов и фичей, при котором допускается увеличение времени исполнения по редко запрашиваемым тегам и фичам
2. Провести нагрузочное тестирование полученного решения и приложить результаты тестирования к решению
3. Иногда получается так, что необходимо вернуться к одной из трех предыдущих версий баннера в связи с найденной ошибкой в логике, тексте и т.д.  Измените API таким образом, чтобы можно было просмотреть существующие версии баннера и выбрать подходящую версию
4. Добавить метод удаления баннеров по фиче или тегу, время ответа которого не должно превышать 100 мс, независимо от количества баннеров.  В связи с небольшим временем ответа метода, рекомендуется ознакомиться с механизмом выполнения отложенных действий 
5. Реализовать интеграционное или E2E-тестирование для остальных сценариев
6. Описать конфигурацию линтера

## Требования по стеку
- **Язык сервиса:** предпочтительным будет Go, при этом вы можете выбрать любой, удобный вам. 
- **База данных:** предпочтительной будет PostgreSQL, при этом вы можете выбрать любую, удобную вам. 
- Для **деплоя зависимостей и самого сервиса** рекомендуется использовать Docker и Docker Compose.
## Ход решения
Если у вас возникнут вопросы по заданию, ответы на которые вы не найдете в описанных «Условиях», то вы вольны принимать решения самостоятельно.  
В таком случае приложите к проекту README-файл, в котором будет список вопросов и пояснения о том, как вы решили проблему и почему именно выбранным вами способом.
## Оформление решения
Необходимо предоставить публичный git-репозиторий на любом публичном хосте (GitHub / GitLab / etc), содержащий в master/main ветке: 
1. Код сервиса
2. Makefile c командами сборки проекта / Описанная в README.md инструкция по запуску
3. Описанные в README.md вопросы/проблемы, с которыми столкнулись,  и ваша логика их решений (если требуется)
